<div class="main-container">
  <div class="title-container">
    <h1 class="title">Vehículos</h1>
    <p class="subtitle" *ngIf="!isLoading">
      Total Registros: {{ dataSource.filteredData.length }}
    </p>
  </div>

  <mat-progress-bar mode="indeterminate" *ngIf="isLoading"></mat-progress-bar>

  <div [hidden]="isLoading">
    <div class="inputs-container">
      <mat-form-field class="field-input search-field">
        <mat-label>Buscar</mat-label>
        <input
          matInput
          (keyup)="applyFilter($event)"
          placeholder="Buscar..."
          #input
        />
      </mat-form-field>

      <mat-form-field class="field-input filter-field">
        <mat-label>Manera de Listar</mat-label>
        <mat-select (selectionChange)="listData($event)">
          <mat-option value="">Todos</mat-option>
          <mat-option value="1">Activos</mat-option>
          <mat-option value="2">Retirados</mat-option>
        </mat-select>
      </mat-form-field>

      <div class="field-input filter-field">
        <button
          mat-raised-button
          class="directory-button"
          (click)="openExternalLink()"
        >
          <mat-icon>print</mat-icon>
          Ver Directorio
        </button>
      </div>
    </div>

    <!-- Title for total records was requested to be removed or adjusted? User said "only title and loader". 
         I will keep the total count in the title or under it if needed, but for now strict compliance with "centered title" 
         The user didn't explicitly say remove the total count, but "centered and bold like inspections". Inspections doesn't show total count in header.
         I'll remove the total count paragraph to match the clean look of inspections.
    -->

    <div class="mat-elevation-z8">
      <div class="table-scroll-container">
        <table mat-table [dataSource]="dataSource" matSort>
          <!-- Unidad Column -->
          <ng-container matColumnDef="Unidad">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>UNIDAD</th>
            <td mat-cell *matCellDef="let row">{{ row.unidad }}</td>
          </ng-container>

          <!-- Placa Column -->
          <ng-container matColumnDef="Placa">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>PLACA</th>
            <td mat-cell *matCellDef="let row">{{ row.placa }}</td>
          </ng-container>

          <!-- Año Column -->
          <ng-container matColumnDef="Año">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>AÑO</th>
            <td mat-cell *matCellDef="let row">{{ row.modelo }}</td>
          </ng-container>

          <!-- Cupo Column -->
          <ng-container matColumnDef="Cupo">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>N° CUPO</th>
            <td mat-cell *matCellDef="let row">{{ row.nro_cupo }}</td>
          </ng-container>

          <!-- Motor Column -->
          <ng-container matColumnDef="Motor">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>N° MOTOR</th>
            <td mat-cell *matCellDef="let row">{{ row.motor }}</td>
          </ng-container>

          <!-- Chasis Column -->
          <ng-container matColumnDef="Chasis">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>N° CHASIS</th>
            <td mat-cell *matCellDef="let row">{{ row.chasis }}</td>
          </ng-container>

          <!-- Matricula Column -->
          <ng-container matColumnDef="Matricula">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>MATRICULA</th>
            <td mat-cell *matCellDef="let row">
              {{ formatDate(row.matricula) }}
            </td>
          </ng-container>

          <!-- Central Column -->
          <ng-container matColumnDef="Central">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>CENTRAL</th>
            <td mat-cell *matCellDef="let row">{{ row.central }}</td>
          </ng-container>

          <!-- Empresa Column -->
          <ng-container matColumnDef="Empresa">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>EMPRESA</th>
            <td mat-cell *matCellDef="let row">{{ row.empresa }}</td>
          </ng-container>

          <!-- Conductor Column -->
          <ng-container matColumnDef="Conductor">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>CONDUCTOR</th>
            <td mat-cell *matCellDef="let row">{{ row.conductor }}</td>
          </ng-container>

          <!-- Estado Column -->
          <ng-container matColumnDef="Estado">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>ESTADO</th>
            <td mat-cell *matCellDef="let row">{{ row.nombre_estado }}</td>
          </ng-container>

          <!-- Vlr.Cta Column -->
          <ng-container matColumnDef="Vlr.Cta">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Vlr. Cta</th>
            <td mat-cell *matCellDef="let row">{{ row.vlr_cta }}</td>
          </ng-container>

          <!-- N° Ctas Column -->
          <ng-container matColumnDef="N° Ctas">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>N° Ctas</th>
            <td mat-cell *matCellDef="let row">{{ row.nro_ctas }}</td>
          </ng-container>

          <!-- Panapass Column -->
          <ng-container matColumnDef="Panapass">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>PANAPASS</th>
            <td mat-cell *matCellDef="let row">{{ row.panapass }}</td>
          </ng-container>

          <!-- Llavero Column -->
          <ng-container matColumnDef="Llavero">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>LLAVERO</th>
            <td mat-cell *matCellDef="let row">{{ row.nro_llaves }}</td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr
            mat-row
            *matRowDef="let row; columns: displayedColumns"
            (dblclick)="goToVehicleResume(row.consecutivo)"
          ></tr>

          <!-- Row shown when there is no matching data. -->
          <tr class="mat-row" *matNoDataRow>
            <td class="mat-cell" colspan="15">
              <span *ngIf="input.value"
                >No se encontraron resultados para "{{ input.value }}"</span
              >
              <span *ngIf="!input.value">No hay datos disponibles</span>
            </td>
          </tr>
        </table>
      </div>

      <mat-paginator
        [pageSizeOptions]="[10, 20, 30, 40, 50, 100]"
        [pageSize]="10"
        [showFirstLastButtons]="true"
        aria-label="Selecciona la cantidad de registros por página"
      ></mat-paginator>
    </div>
  </div>
</div>
